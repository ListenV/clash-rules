mode: rule
mixed-port: 7890             #本地混合代理(http和socks5合并）端口
# redir-port: 7892           #本地Linux/macOS Redir代理端口
# tproxy-port: 7893          #本地Linux Tproxy代理端口

log-level: info              #日志等级（info/warning/error/debug/silent）

unified-delay: true          # 统一延迟
tcp-concurrent: true         # TCP连接并发，如果域名解析结果对应多个IP，
                             # 并发所有IP，选择握手最快的IP进行连接

ipv6: false                  # ip6开关，当为false时，停止解析hostanmes为ip6地址

allow-lan: false             # 允许局域网连接代理
bind-address: "*"            # 代理监听IP地址，"*" 绑定所有IP地址

geodata-mode: false          #【Meta专属】使用geoip.dat数据库(默认：false使用mmdb数据库)
#geodata-loader: standard     # geo文件加载模式：standard 标准模式；memconservative 内存受限模式，专为小内存设备优化
geo-auto-update: true        # geo文件自动更新开关
geo-update-interval: 24      # 更新间隔（单位：小时
geox-url:                    # 自定义下载地址
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb"

external-controller: 127.0.0.1:9090   # API 监听地址（可通过API操作clash）
#external-ui: /path/folder            # Web 静态资源路径（如yacd的控制面板
                                      # 可通过`http://{{external-controller}}/ui`直接使用
external-controller-cors:             # CORS
  #allow-origins:
  #  - '*'
  allow-private-network: true
#secret: ""                           # Web 登录密码


#interface-name: en0        #出口网卡名称
#routing-mark: 6666         #流量标记(仅Linux)

profile:                   #缓存设置(文件位置./cache.db)
  store-selected: true     #节点状态记忆（若不同配置有同代理名称,设置值共享）
  store-fake-ip: true      #fake-ip缓存

dns:
  enable: true                     #DNS开关(false/true)
  ipv6: false                      #IP6解析开关；如果为false，将返回ip6结果为空
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16     #Fake-IP解析地址池
  fake-ip-filter:                  #Fake-ip过滤，列表中的域名返回真实ip
    - geosite:private
    - geosite:connectivity-check

  default-nameserver:              # 用于解析DNS域名的DNS服务
    - tls://223.5.5.5
    - tls://223.6.6.6
  nameserver:                      # 默认的域名解析服务器（除了直连域名其他的全走默认DNS，使用国外DNS，避免DNS泄漏
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query
  direct-nameserver:               # 用于 direct 出口域名解析的 DNS 服务器。如不填，则使用nameserver
    - https://223.5.5.5/dns-query
    - https://doh.pub/dns-query
    - https://223.6.6.6/dns-query
  respect-rules: true              # DNS 连接遵守路由规则，需配置proxy-server-nameserver
  proxy-server-nameserver:         # 代理节点域名解析服务器。如不填，则使用nameserver
    - https://223.5.5.5/dns-query
    - https://doh.pub/dns-query
    - https://223.6.6.6/dns-query

tun:                                    # 虚拟网卡模式
  enable: false                         # 建议在必要的时候手动开启
  stack: system                         # Tun 模式堆栈，建议使用顺序：system > mixed > gvisor
  device: Mihomo                        # 虚拟网卡名称
  auto-route: true                      # 自动设置全局路由，可以自动将全局流量路由进入 tun 网卡。
  auto-redirect: true                   # 仅支持 Linux，自动配置 iptables/nftables 以重定向 TCP 连接，需要auto-route已启用
  auto-detect-interface: true           # 自动选择流量出口网口
  dns-hijack:                           # dns 劫持，将匹配到的连接导入内部 dns 模块，不书写协议则为 udp://
    - any:53
    - tcp://any:53
  strict-route: true                    # 执行严格的路由规则
  mtu: 1500
  # 如果有使用zerotier或者headscale等，需要自己配置排除自己的网段
  # route-exclude-address: ["192.168.110.0/24"]

proxy-providers:
  Subscribe:
    type: http
    url: <URL>
    path: ./Subscribe.yaml
    interval: 86400                      # 24 小时
    health-check:
      enable: true
      interval: 600
      url: http://cp.cloudflare.com/generate_204
    filter: "低倍率"
    exclude-filter: "套餐|剩余|过期|到期|重置"



proxy-groups:
  - name: PROXY
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Rocket.png
    proxies:
      - 自动选择
      - 手动选择
  - name: 自动选择
    type: url-test
    interval: 600
    url: http://cp.cloudflare.com/generate_204
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Auto.png
    use: [Subscribe]
  - name: 手动选择
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Rocket.png
    use: [Subscribe]
  - name: AI
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Copilot.png
    use: [Subscribe]
    proxies:
      - DIRECT
      - 自动选择
      - 手动选择
  - name: Github
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/GitHub.png
    proxies:
      - DIRECT
      - 自动选择
      - 手动选择
  - name: Jetbrains
    type: select
    icon: https://fastly.jsdelivr.net/gh/JetBrains/logos/web/all-products-pack/all-products-pack.svg
    proxies:
      - DIRECT
      - 自动选择
      - 手动选择
  - name: 微软
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Microsoft.png
    proxies:
      - DIRECT
      - 自动选择
      - 手动选择
  - name: 游戏平台
    type: select
    icon: https://fastly.jsdelivr.net/gh/Koolson/Qure/IconSet/Color/Steam.png
    proxies:
      - DIRECT
      - 自动选择
      - 手动选择

# 黑名单规则，只有匹配到域名的才使用代理，其他全部直连
# 一键替换 PROXY 即可
rules:
  - DOMAIN-SUFFIX,unsplash.com,DIRECT
  - RULE-SET,proxy,PROXY
  - RULE-SET,Jetbrains,Jetbrains
  - RULE-SET,Github,Github
  - RULE-SET,Microsoft,微软
  - RULE-SET,Steam,游戏平台
  - RULE-SET,Epic,游戏平台
  - RULE-SET,AI,AI
  - RULE-SET,Google,PROXY
  - RULE-SET,Binance,PROXY
  - RULE-SET,ProxyLite,PROXY
  - MATCH,DIRECT

rule-providers:
  proxy:
    type: http
    format: text
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/ListenV/clash-rules/collection/proxy.txt
    path: ./ruleset/proxy.txt
    interval: 86400

  Jetbrains:
    type: http
    behavior: classical
    url: https://fastly.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/Jetbrains/Jetbrains_No_Resolve.yaml
    path: ./ruleset/Jetbrains.yaml
    interval: 86400
  Microsoft:
    type: http
    format: text
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Ruleset/Microsoft.list
    path: ./ruleset/Microsoft.list
    interval: 86400
  Github:
    type: http
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/GitHub/GitHub.yaml
    path: ./ruleset/Github.yml
    interval: 86400

  Epic:
    type: http
    behavior: classical
    url: https://fastly.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Epic/Epic.yaml
    path: ./ruleset/Epic.yaml
    interval: 86400
  Steam:                      # 不含SteamCN
    type: http
    behavior: classical
    url: https://fastly.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/Steam/Steam.yaml
    path: ./ruleset/Steam.yaml
    interval: 86400
  Google:                     # 包含GoogleDrive GoogleSearch GoogleVoice （含IP，需No_Resolve
    type: http
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/Google/Google_No_Resolve.yaml
    path: ./ruleset/Google.yaml
    interval: 86400
  AI:
    type: http
    format: text
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/ACL4SSR/ACL4SSR@master/Clash/Ruleset/AI.list
    path: ./ruleset/AI.list
    interval: 86400
  Binance:
    type: http
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/Binance/Binance.yaml
    path: ./ruleset/Binance.yml
    interval: 86400

  ProxyLite:
    type: http
    behavior: classical
    url: https://testingcf.jsdelivr.net/gh/blackmatrix7/ios_rule_script/rule/Clash/ProxyLite/ProxyLite_No_Resolve.yaml
    path: ./ruleset/ProxyLite.yaml
    interval: 86400

